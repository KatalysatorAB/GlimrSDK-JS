!function(t){"use strict";var e="//pixel.glimr.io",a="/v3/iptags/:id/",r=300,n=function(){},i={tags:0},s={bindFunction:function(t,e){var a=Array.prototype.slice.call(arguments,2),r=e,n=function(){},i=function(){return r.apply(this instanceof n?this:t,a.concat(Array.prototype.slice.call(arguments)))};return e.prototype&&(n.prototype=e.prototype),i.prototype=new n,i},JSONP:function(e,a){t.Glimr.networkRequests+=1;var r=(new Date).getTime(),n="glmrjsonp"+Math.round(r+1000001*Math.random()),i=document.createElement("script");t[n]=function(e){a(e);try{delete t[n]}catch(r){t[n]=void 0}try{i.parentNode.removeChild(i)}catch(r){}},e+=-1===e.indexOf("?")?"?":"&",e+="callback="+n,"function"==typeof i.addEventListener&&i.addEventListener("error",function(){a(!1)},!1),i.setAttribute("src",e),document.getElementsByTagName("head")[0].appendChild(i)},createCookie:function(t,e,a){var r=document.location.hostname.split("."),n=r.slice(r.length-2,r.length).join("."),i="";if(a){var s=new Date;s.setTime(s.getTime()+24*a*60*60*1e3),i="; expires="+s.toGMTString()}document.cookie=t+"="+e+i+"; path=/; domain="+n},readCookie:function(t){for(var e=t+"=",a=document.cookie.split(";"),r=0;r<a.length;r+=1){for(var n=a[r];" "===n.charAt(0);)n=n.substring(1,n.length);if(0===n.indexOf(e))return n.substring(e.length,n.length)}return null},generateUUID:function(){var t=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var a=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"===e?a:3&a|8).toString(16)})}},o=function(){this.constructor=o,this.initialize()},g=o.prototype;g.initialize=function(){this.networkRequests=0,this.url={host:e,tags:a},this.useLocalStorage=!!t.localStorage,this.state={urlCache:{},loadingTags:{},loadedTags:{}}},g.initGlimrId=function(){this.glimrId=s.readCookie("__glmrid"),this.glimrId||(this.glimrId=s.generateUUID(),this.setGlimrCookie())},g.setTagCacheTimeInSeconds=function(t){t>r&&(t=r),i.tags=t},g.getTagCacheTimeInSeconds=function(){return i.tags},g.setGlimrCookie=function(){s.createCookie("__glmrid",this.glimrId)},g.currentURLCacheKey=function(){return this.state.currentURLCacheKey?this.state.currentURLCacheKey:n(document.location.pathname).substr(0,10)},g.getPixelLastUpdated=function(t){return this.useLocalStorage?localStorage["glimrArticleTags_"+t+"_lastUpdate"]||!1:!1},g.getCachedURLTags=function(t){var e=this._getOrUnmarshalCache(t),a=this.currentURLCacheKey();return e[a]||(e[a]=[]),e[a]},g.getCachedTags=function(e){return t.console&&t.console.warn&&t.console.warn("`Glimr.getCachedTags` has been deprecated in favor of `Glimr.getCachedURLTags` for getting pre-fetched tags synchronously. `Glimr.getCachedTags` and `Glimr.getCachedURLTags` only return a subset of the available tags, use `Glimr.getTags` for fetching all tags, which takes care of caching behind the scenes."),this.getCachedURLTags.apply(this,arguments)},g.getTags=function(t,e){return this.state.loadedTags[t]?void e(this.state.loadedTags[t]):"undefined"!=typeof this.state.loadingTags[t]?void this.state.loadingTags[t].push(e):(this.state.loadingTags[t]=[],this.state.loadingTags[t].push(e),void this._requestTags(t,e,s.bindFunction(this,function(e){var a=[];e&&e.tags&&(a=e.tags),e&&e.cache&&this._updateURLCache(t,e.cache),this.usesTagCache()&&this._updateTagCache(t,a);for(var r=this.getCachedURLTags(t),n=0;n<r.length;n+=1)-1===a.indexOf(r[n])&&a.push(r[n]);this.state.loadedTags[t]=a;var i=this.state.loadingTags[t];delete this.state.loadingTags[t];for(var s=0;s<i.length;s+=1)i[s](a);"string"==typeof e.id&&e.id!==this.glimrId&&(this.glimrId=e.id,this.setGlimrCookie())})))},g._getLocalTags=function(t,e){var a=localStorage["glimrTags_"+t].split(","),r=this.getCachedURLTags(t);e(a.concat(r))},g._requestTags=function(t,e,a){this.initGlimrId();var r=this.getPixelLastUpdated(t),n="";r&&(n+="&keywords_last_updated="+r);var o=(this.url.host+this.url.tags).replace(":id",t)+"?id="+this.glimrId+n;if(this.usesTagCache()){var g=parseInt(localStorage["glimrTags_"+t+"_lastUpdate"],10),c=(new Date).getTime();if(!isNaN(g)&&(c-g)/1e3<i.tags)return void this._getLocalTags(t,e)}s.JSONP(o,a)},g.getTagsAndPushToDataLayer=function(e,a){this.getTags(e,function(e){t.dataLayer&&t.dataLayer.push&&t.dataLayer.push({glimrTags:e,event:"glimr.tags"}),a&&"function"==typeof a&&a()})},g.usesTagCache=function(){return i.tags>0&&this.useLocalStorage},g._unmarshalTags=function(t){if(!t)return{};for(var e=t.split("|"),a={},r=0;r<e.length;r+=1){var n=e[r].indexOf("="),i=e[r].substring(0,n);a[i]=e[r].substring(n+1).split(",")}return a},g._marshalTags=function(t){var e=[];for(var a in t)t.hasOwnProperty(a)&&e.push(a.substr(0,10)+"="+t[a].join(","));return e.join("|")},g._updateURLCache=function(t,e){this.useLocalStorage&&(localStorage["glimrArticleTags_"+t]=this._marshalTags(e),localStorage["glimrArticleTags_"+t+"_lastUpdate"]=(new Date).getTime()),this.state.urlCache[t]||(this.state.urlCache[t]={});for(var a in e)e.hasOwnProperty(a)&&(this.state.urlCache[t][a.substr(0,10)]=e[a])},g._getOrUnmarshalCache=function(t){return this.useLocalStorage&&localStorage["glimrArticleTags_"+t]&&(this.state.urlCache[t]=this._unmarshalTags(localStorage["glimrArticleTags_"+t])),this.state.urlCache[t]||{}},g._updateTagCache=function(t,e){this.useLocalStorage&&(localStorage["glimrTags_"+t+"_lastUpdate"]=(new Date).getTime(),localStorage["glimrTags_"+t]=e.join(","))},n=function(t){function e(t,e){return t<<e|t>>>32-e}function a(t,e){var a,r,n,i,s;return n=2147483648&t,i=2147483648&e,a=1073741824&t,r=1073741824&e,s=(1073741823&t)+(1073741823&e),a&r?2147483648^s^n^i:a|r?1073741824&s?3221225472^s^n^i:1073741824^s^n^i:s^n^i}function r(t,e,a){return t&e|~t&a}function n(t,e,a){return t&a|e&~a}function i(t,e,a){return t^e^a}function s(t,e,a){return e^(t|~a)}function o(t,n,i,s,o,g,c){return t=a(t,a(a(r(n,i,s),o),c)),a(e(t,g),n)}function g(t,r,i,s,o,g,c){return t=a(t,a(a(n(r,i,s),o),c)),a(e(t,g),r)}function c(t,r,n,s,o,g,c){return t=a(t,a(a(i(r,n,s),o),c)),a(e(t,g),r)}function l(t,r,n,i,o,g,c){return t=a(t,a(a(s(r,n,i),o),c)),a(e(t,g),r)}function h(t){for(var e,a=t.length,r=a+8,n=(r-r%64)/64,i=16*(n+1),s=Array(i-1),o=0,g=0;a>g;)e=(g-g%4)/4,o=g%4*8,s[e]=s[e]|t.charCodeAt(g)<<o,g+=1;return e=(g-g%4)/4,o=g%4*8,s[e]=s[e]|128<<o,s[i-2]=a<<3,s[i-1]=a>>>29,s}function u(t){var e,a,r="",n="";for(a=0;3>=a;a+=1)e=t>>>8*a&255,n="0"+e.toString(16),r+=n.substr(n.length-2,2);return r}function d(t){t=t.replace(/\r\n/g,"\n");for(var e="",a=0;a<t.length;a+=1){var r=t.charCodeAt(a);128>r?e+=String.fromCharCode(r):r>127&&2048>r?(e+=String.fromCharCode(r>>6|192),e+=String.fromCharCode(63&r|128)):(e+=String.fromCharCode(r>>12|224),e+=String.fromCharCode(r>>6&63|128),e+=String.fromCharCode(63&r|128))}return e}var f,m,p,T,C,v,x,y,_,L=[],S=7,U=12,w=17,b=22,k=5,I=9,R=14,A=20,G=4,O=11,D=16,P=23,N=6,j=10,M=15,q=21;for(t=d(t),L=h(t),v=1732584193,x=4023233417,y=2562383102,_=271733878,f=0;f<L.length;f+=16)m=v,p=x,T=y,C=_,v=o(v,x,y,_,L[f+0],S,3614090360),_=o(_,v,x,y,L[f+1],U,3905402710),y=o(y,_,v,x,L[f+2],w,606105819),x=o(x,y,_,v,L[f+3],b,3250441966),v=o(v,x,y,_,L[f+4],S,4118548399),_=o(_,v,x,y,L[f+5],U,1200080426),y=o(y,_,v,x,L[f+6],w,2821735955),x=o(x,y,_,v,L[f+7],b,4249261313),v=o(v,x,y,_,L[f+8],S,1770035416),_=o(_,v,x,y,L[f+9],U,2336552879),y=o(y,_,v,x,L[f+10],w,4294925233),x=o(x,y,_,v,L[f+11],b,2304563134),v=o(v,x,y,_,L[f+12],S,1804603682),_=o(_,v,x,y,L[f+13],U,4254626195),y=o(y,_,v,x,L[f+14],w,2792965006),x=o(x,y,_,v,L[f+15],b,1236535329),v=g(v,x,y,_,L[f+1],k,4129170786),_=g(_,v,x,y,L[f+6],I,3225465664),y=g(y,_,v,x,L[f+11],R,643717713),x=g(x,y,_,v,L[f+0],A,3921069994),v=g(v,x,y,_,L[f+5],k,3593408605),_=g(_,v,x,y,L[f+10],I,38016083),y=g(y,_,v,x,L[f+15],R,3634488961),x=g(x,y,_,v,L[f+4],A,3889429448),v=g(v,x,y,_,L[f+9],k,568446438),_=g(_,v,x,y,L[f+14],I,3275163606),y=g(y,_,v,x,L[f+3],R,4107603335),x=g(x,y,_,v,L[f+8],A,1163531501),v=g(v,x,y,_,L[f+13],k,2850285829),_=g(_,v,x,y,L[f+2],I,4243563512),y=g(y,_,v,x,L[f+7],R,1735328473),x=g(x,y,_,v,L[f+12],A,2368359562),v=c(v,x,y,_,L[f+5],G,4294588738),_=c(_,v,x,y,L[f+8],O,2272392833),y=c(y,_,v,x,L[f+11],D,1839030562),x=c(x,y,_,v,L[f+14],P,4259657740),v=c(v,x,y,_,L[f+1],G,2763975236),_=c(_,v,x,y,L[f+4],O,1272893353),y=c(y,_,v,x,L[f+7],D,4139469664),x=c(x,y,_,v,L[f+10],P,3200236656),v=c(v,x,y,_,L[f+13],G,681279174),_=c(_,v,x,y,L[f+0],O,3936430074),y=c(y,_,v,x,L[f+3],D,3572445317),x=c(x,y,_,v,L[f+6],P,76029189),v=c(v,x,y,_,L[f+9],G,3654602809),_=c(_,v,x,y,L[f+12],O,3873151461),y=c(y,_,v,x,L[f+15],D,530742520),x=c(x,y,_,v,L[f+2],P,3299628645),v=l(v,x,y,_,L[f+0],N,4096336452),_=l(_,v,x,y,L[f+7],j,1126891415),y=l(y,_,v,x,L[f+14],M,2878612391),x=l(x,y,_,v,L[f+5],q,4237533241),v=l(v,x,y,_,L[f+12],N,1700485571),_=l(_,v,x,y,L[f+3],j,2399980690),y=l(y,_,v,x,L[f+10],M,4293915773),x=l(x,y,_,v,L[f+1],q,2240044497),v=l(v,x,y,_,L[f+8],N,1873313359),_=l(_,v,x,y,L[f+15],j,4264355552),y=l(y,_,v,x,L[f+6],M,2734768916),x=l(x,y,_,v,L[f+13],q,1309151649),v=l(v,x,y,_,L[f+4],N,4149444226),_=l(_,v,x,y,L[f+11],j,3174756917),y=l(y,_,v,x,L[f+2],M,718787259),x=l(x,y,_,v,L[f+9],q,3951481745),v=a(v,m),x=a(x,p),y=a(y,T),_=a(_,C);var E=u(v)+u(x)+u(y)+u(_);return E.toLowerCase()},t.Glimr=new o}(window);
