!function(t,e){"use strict";var r="//pixel.glimr.io",a="/v4/iptags/:id/",n=300,i=function(){},s={tags:0},o="[v2]:",u=function(){var e,r,a=(new Date).getTime().toString();try{return(e=t.localStorage).setItem(a,a),r=e.getItem(a)===a,e.removeItem(a),r&&e}catch(n){}}(),c={flattenObjectIntoArray:function(t){var e=[];for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){var a=t[r];if("object"==typeof a&&a.constructor===Array)for(var n=0,i=a.length;i>n;n+=1)e.push(a[n]);else"object"==typeof a?e=e.concat(c.Library.flattenObjectIntoArray(a)):e.push(a)}return e},bindFunction:function(t,e){var r=Array.prototype.slice.call(arguments,2),a=e,n=function(){},i=function(){return a.apply(this instanceof n?this:t,r.concat(Array.prototype.slice.call(arguments)))};return e.prototype&&(n.prototype=e.prototype),i.prototype=new n,i},JSONP:function(r,a){t.Glimr.networkRequests+=1;var n=(new Date).getTime(),i="glmrjsonp"+Math.round(n+1000001*Math.random()),s=e.createElement("script");t[i]=function(e){a(e);try{delete t[i]}catch(r){t[i]=void 0}try{s.parentNode.removeChild(s)}catch(r){}},r+=-1===r.indexOf("?")?"?":"&",r+="callback="+i,"function"==typeof s.addEventListener&&s.addEventListener("error",function(){a(!1)},!1),s.setAttribute("src",r),e.getElementsByTagName("head")[0].appendChild(s)},createCookie:function(t,r,a){var n=e.location.hostname.split("."),i=n.slice(n.length-2,n.length).join("."),s="";if(a){var o=new Date;o.setTime(o.getTime()+24*a*60*60*1e3),s="; expires="+o.toGMTString()}e.cookie=t+"="+r+s+"; path=/; domain="+i},readCookie:function(t){for(var r=t+"=",a=e.cookie.split(";"),n=0;n<a.length;n+=1){for(var i=a[n];" "===i.charAt(0);)i=i.substring(1,i.length);if(0===i.indexOf(r))return i.substring(r.length,i.length)}return null},generateUUID:function(){var t=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var r=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"===e?r:3&r|8).toString(16)})}},h=function(){this.constructor=h,this.initialize()},g=h.prototype;g.initialize=function(){this.networkRequests=0,this.url={host:r,tags:a},this.useLocalStorage=!!u,this.state={urlCache:{},loadingTags:{},loadedTags:{}}},g.initGlimrId=function(){this.glimrId=c.readCookie("__glmrid"),this.glimrId||(this.glimrId=c.generateUUID(),this.setGlimrCookie())},g.setTagCacheTimeInSeconds=function(t){t>n&&(t=n),s.tags=t},g.getTagCacheTimeInSeconds=function(){return s.tags},g.setGlimrCookie=function(){c.createCookie("__glmrid",this.glimrId)},g.currentURLCacheKey=function(){return this.state.currentURLCacheKey?this.state.currentURLCacheKey:i(this.currentURLIdentifier()).substr(0,10)},g.currentURLIdentifier=function(){return e.location.hash&&-1!==e.location.hash.indexOf("#!")?e.location.hash.replace("#!",""):e.location.pathname},g.getPixelLastUpdated=function(t){return this.useLocalStorage?u["glimrArticleTags_"+t+"_lastUpdate"]||!1:!1},g.getCachedURLTags=function(t){var e=this._getOrUnmarshalCache(t),r=this.currentURLCacheKey();return e[r]||(e[r]=[]),e[r]},g.getCachedBehaviorTags=function(t){if(this.usesTagCache()&&this.isTagCacheValid(t)){var e=this._getLocalTags(t);return e[0]}return!1},g.getCachedBehaviorTagsAndUpdateInBackground=function(e,r){if(r=r||{},r.onUpdate="function"==typeof r.onUpdate?r.onUpdate:function(){},!this.usesTagCache())return t.console&&t.console.error("Caching not enabled. Enable with Glimr.setTagCacheTimeInSeconds(number)"),[];var a=this._getLocalTags(e);return this.isTagCacheValid(e)||this.getTags(e,r.onUpdate),a[0]||!1},g.getTags=function(t,e){var r=t+this.currentURLCacheKey();if(this.state.loadedTags[r]){var a=this.state.loadedTags[r];return void e(a[0],a[1])}return"undefined"!=typeof this.state.loadingTags[r]?void this.state.loadingTags[r].push(e):void this._requestTags(t,r,e,c.bindFunction(this,function(e){var a=[],n={},i=a;e&&e.tags&&(a=e.tags,i=a),e&&e.mapping&&(n=e.mapping,i=n),e&&e.cache&&this._updateURLCache(t,e.cache),this.usesTagCache()&&this._updateTagCache(t,i);for(var s=this.getCachedURLTags(t),o=0;o<s.length;o+=1)-1===a.indexOf(s[o])&&(a.push(s[o]),n.urlTags=n.urlTags||[],n.urlTags.push(s[o]));this.state.loadedTags[r]=[a,n];var u=this.state.loadingTags[r];delete this.state.loadingTags[r];for(var c=0;c<u.length;c+=1)u[c](a,n);"string"==typeof e.id&&e.id!==this.glimrId&&(this.glimrId=e.id,this.setGlimrCookie())}))},g._getLocalTags=function(t){var e=this._deserializeTags(u["glimrTags_"+t]),r=this.getCachedURLTags(t);if("object"==typeof e&&e.constructor===Array)return[e.concat(r),{urlTags:r}];e.urlTags=r;var a=c.flattenObjectIntoArray(e);return[a,e]},g._requestTags=function(t,r,a,n){this.initGlimrId();var i=this.getPixelLastUpdated(t),s="";i&&(s+="&keywords_last_updated="+i),e.location.hash&&(s+="&fragment="+encodeURIComponent(e.location.hash));var o=(this.url.host+this.url.tags).replace(":id",t)+"?id="+this.glimrId+s;if(this.usesTagCache()&&this.isTagCacheValid(t)){var u=this._getLocalTags(t);return void a(u[0],u[1])}this.state.loadingTags[r]=[],this.state.loadingTags[r].push(a),c.JSONP(o,n)},g.getTagsAndPushToDataLayer=function(e,r){this.getTags(e,function(e){t.dataLayer&&t.dataLayer.push&&t.dataLayer.push({glimrTags:e,event:"glimr.tags"}),r&&"function"==typeof r&&r()})},g.usesTagCache=function(){return s.tags>0&&this.useLocalStorage},g.isTagCacheValid=function(t){var e=parseInt(u["glimrTags_"+t+"_lastUpdate"],10),r=(new Date).getTime();return!isNaN(e)&&(r-e)/1e3<s.tags},g.objectToQuery=function(t){var e=[];for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){var a=t[r];"object"==typeof a&&a.constructor===Array?e.push(this.arrayToQuery(a,r)):"object"==typeof r?e.push(this.objectToQuery(a)):e.push(this.escapeStringForQuery(r)+"="+this.escapeStringForQuery(a)),e.push("&")}return e.pop(),e.join("")},g.arrayToQuery=function(t,e){e=e||"";for(var r=this.escapeStringForQuery(e),a=[],n=0,i=t.length;i>n;n+=1){var s=this.escapeStringForQuery(t[n]);a.push(r+"="+s)}return a.join("&")},g.queryToObject=function(t){for(var e={},r=t.split("&"),a=0,n=r.length;n>a;a+=1){var i=r[a].split("="),s=this.unescapeStringForQuery(i[0]||""),o=this.unescapeStringForQuery(i[1]||"");"undefined"==typeof e[s]&&(e[s]=[]),o.length>0&&e[s].push(o)}return e},g.escapeStringForQuery=function(t){return encodeURIComponent(t)},g.unescapeStringForQuery=function(t){return decodeURIComponent(t)},g._unmarshalTags=function(t){if(!t)return{};for(var e=t.split("|"),r={},a=0;a<e.length;a+=1){var n=e[a].indexOf("="),i=e[a].substring(0,n);r[i]=this._deserializeTags(e[a].substring(n+1))}return r},g._marshalTags=function(t){var e=[];for(var r in t)t.hasOwnProperty(r)&&e.push(r.substr(0,10)+"="+this._serializeTags(t[r]));return e.join("|")},g._updateURLCache=function(t,e){this.useLocalStorage&&(u["glimrArticleTags_"+t]=this._marshalTags(e),u["glimrArticleTags_"+t+"_lastUpdate"]=(new Date).getTime()),this.state.urlCache[t]||(this.state.urlCache[t]={});for(var r in e)e.hasOwnProperty(r)&&(this.state.urlCache[t][r.substr(0,10)]=e[r])},g._getOrUnmarshalCache=function(t){return this.useLocalStorage&&u["glimrArticleTags_"+t]&&(this.state.urlCache[t]=this._unmarshalTags(u["glimrArticleTags_"+t])),this.state.urlCache[t]||{}},g._serializeTags=function(t){return"object"==typeof t&&t.constructor===Array?t.join(","):o+this.objectToQuery(t)},g._deserializeTags=function(t){return t=t||"",t.substr(0,o.length)===o?this.queryToObject(t.substr(o.length)):""===t?[]:t.split(",")},g._updateTagCache=function(t,e){this.useLocalStorage&&(u["glimrTags_"+t+"_lastUpdate"]=(new Date).getTime(),u["glimrTags_"+t]=this._serializeTags(e))},i=function(t){function e(t,e){return t<<e|t>>>32-e}function r(t,e){var r,a,n,i,s;return n=2147483648&t,i=2147483648&e,r=1073741824&t,a=1073741824&e,s=(1073741823&t)+(1073741823&e),r&a?2147483648^s^n^i:r|a?1073741824&s?3221225472^s^n^i:1073741824^s^n^i:s^n^i}function a(t,e,r){return t&e|~t&r}function n(t,e,r){return t&r|e&~r}function i(t,e,r){return t^e^r}function s(t,e,r){return e^(t|~r)}function o(t,n,i,s,o,u,c){return t=r(t,r(r(a(n,i,s),o),c)),r(e(t,u),n)}function u(t,a,i,s,o,u,c){return t=r(t,r(r(n(a,i,s),o),c)),r(e(t,u),a)}function c(t,a,n,s,o,u,c){return t=r(t,r(r(i(a,n,s),o),c)),r(e(t,u),a)}function h(t,a,n,i,o,u,c){return t=r(t,r(r(s(a,n,i),o),c)),r(e(t,u),a)}function g(t){for(var e,r=t.length,a=r+8,n=(a-a%64)/64,i=16*(n+1),s=Array(i-1),o=0,u=0;r>u;)e=(u-u%4)/4,o=u%4*8,s[e]=s[e]|t.charCodeAt(u)<<o,u+=1;return e=(u-u%4)/4,o=u%4*8,s[e]=s[e]|128<<o,s[i-2]=r<<3,s[i-1]=r>>>29,s}function l(t){var e,r,a="",n="";for(r=0;3>=r;r+=1)e=t>>>8*r&255,n="0"+e.toString(16),a+=n.substr(n.length-2,2);return a}function d(t){t=t.replace(/\r\n/g,"\n");for(var e="",r=0;r<t.length;r+=1){var a=t.charCodeAt(r);128>a?e+=String.fromCharCode(a):a>127&&2048>a?(e+=String.fromCharCode(a>>6|192),e+=String.fromCharCode(63&a|128)):(e+=String.fromCharCode(a>>12|224),e+=String.fromCharCode(a>>6&63|128),e+=String.fromCharCode(63&a|128))}return e}var f,p,T,m,y,v,C,x,_,b=[],L=7,U=12,S=17,I=22,j=5,w=9,A=14,O=20,R=4,k=11,Q=16,D=23,F=6,G=10,P=15,z=21;for(t=d(t),b=g(t),v=1732584193,C=4023233417,x=2562383102,_=271733878,f=0;f<b.length;f+=16)p=v,T=C,m=x,y=_,v=o(v,C,x,_,b[f+0],L,3614090360),_=o(_,v,C,x,b[f+1],U,3905402710),x=o(x,_,v,C,b[f+2],S,606105819),C=o(C,x,_,v,b[f+3],I,3250441966),v=o(v,C,x,_,b[f+4],L,4118548399),_=o(_,v,C,x,b[f+5],U,1200080426),x=o(x,_,v,C,b[f+6],S,2821735955),C=o(C,x,_,v,b[f+7],I,4249261313),v=o(v,C,x,_,b[f+8],L,1770035416),_=o(_,v,C,x,b[f+9],U,2336552879),x=o(x,_,v,C,b[f+10],S,4294925233),C=o(C,x,_,v,b[f+11],I,2304563134),v=o(v,C,x,_,b[f+12],L,1804603682),_=o(_,v,C,x,b[f+13],U,4254626195),x=o(x,_,v,C,b[f+14],S,2792965006),C=o(C,x,_,v,b[f+15],I,1236535329),v=u(v,C,x,_,b[f+1],j,4129170786),_=u(_,v,C,x,b[f+6],w,3225465664),x=u(x,_,v,C,b[f+11],A,643717713),C=u(C,x,_,v,b[f+0],O,3921069994),v=u(v,C,x,_,b[f+5],j,3593408605),_=u(_,v,C,x,b[f+10],w,38016083),x=u(x,_,v,C,b[f+15],A,3634488961),C=u(C,x,_,v,b[f+4],O,3889429448),v=u(v,C,x,_,b[f+9],j,568446438),_=u(_,v,C,x,b[f+14],w,3275163606),x=u(x,_,v,C,b[f+3],A,4107603335),C=u(C,x,_,v,b[f+8],O,1163531501),v=u(v,C,x,_,b[f+13],j,2850285829),_=u(_,v,C,x,b[f+2],w,4243563512),x=u(x,_,v,C,b[f+7],A,1735328473),C=u(C,x,_,v,b[f+12],O,2368359562),v=c(v,C,x,_,b[f+5],R,4294588738),_=c(_,v,C,x,b[f+8],k,2272392833),x=c(x,_,v,C,b[f+11],Q,1839030562),C=c(C,x,_,v,b[f+14],D,4259657740),v=c(v,C,x,_,b[f+1],R,2763975236),_=c(_,v,C,x,b[f+4],k,1272893353),x=c(x,_,v,C,b[f+7],Q,4139469664),C=c(C,x,_,v,b[f+10],D,3200236656),v=c(v,C,x,_,b[f+13],R,681279174),_=c(_,v,C,x,b[f+0],k,3936430074),x=c(x,_,v,C,b[f+3],Q,3572445317),C=c(C,x,_,v,b[f+6],D,76029189),v=c(v,C,x,_,b[f+9],R,3654602809),_=c(_,v,C,x,b[f+12],k,3873151461),x=c(x,_,v,C,b[f+15],Q,530742520),C=c(C,x,_,v,b[f+2],D,3299628645),v=h(v,C,x,_,b[f+0],F,4096336452),_=h(_,v,C,x,b[f+7],G,1126891415),x=h(x,_,v,C,b[f+14],P,2878612391),C=h(C,x,_,v,b[f+5],z,4237533241),v=h(v,C,x,_,b[f+12],F,1700485571),_=h(_,v,C,x,b[f+3],G,2399980690),x=h(x,_,v,C,b[f+10],P,4293915773),C=h(C,x,_,v,b[f+1],z,2240044497),v=h(v,C,x,_,b[f+8],F,1873313359),_=h(_,v,C,x,b[f+15],G,4264355552),x=h(x,_,v,C,b[f+6],P,2734768916),C=h(C,x,_,v,b[f+13],z,1309151649),v=h(v,C,x,_,b[f+4],F,4149444226),_=h(_,v,C,x,b[f+11],G,3174756917),x=h(x,_,v,C,b[f+2],P,718787259),C=h(C,x,_,v,b[f+9],z,3951481745),v=r(v,p),C=r(C,T),x=r(x,m),_=r(_,y);var q=l(v)+l(C)+l(x)+l(_);return q.toLowerCase()},t.Glimr=new h}(window,window.document);
