!function(t){"use strict";var e="//pixel.glimr.io",r="/v3/iptags/:id/",a=300,n=function(){},i={tags:0},s="[v2]:",o={bindFunction:function(t,e){var r=Array.prototype.slice.call(arguments,2),a=e,n=function(){},i=function(){return a.apply(this instanceof n?this:t,r.concat(Array.prototype.slice.call(arguments)))};return e.prototype&&(n.prototype=e.prototype),i.prototype=new n,i},JSONP:function(e,r){t.Glimr.networkRequests+=1;var a=(new Date).getTime(),n="glmrjsonp"+Math.round(a+1000001*Math.random()),i=document.createElement("script");t[n]=function(e){r(e);try{delete t[n]}catch(a){t[n]=void 0}try{i.parentNode.removeChild(i)}catch(a){}},e+=-1===e.indexOf("?")?"?":"&",e+="callback="+n,"function"==typeof i.addEventListener&&i.addEventListener("error",function(){r(!1)},!1),i.setAttribute("src",e),document.getElementsByTagName("head")[0].appendChild(i)},createCookie:function(t,e,r){var a=document.location.hostname.split("."),n=a.slice(a.length-2,a.length).join("."),i="";if(r){var s=new Date;s.setTime(s.getTime()+24*r*60*60*1e3),i="; expires="+s.toGMTString()}document.cookie=t+"="+e+i+"; path=/; domain="+n},readCookie:function(t){for(var e=t+"=",r=document.cookie.split(";"),a=0;a<r.length;a+=1){for(var n=r[a];" "===n.charAt(0);)n=n.substring(1,n.length);if(0===n.indexOf(e))return n.substring(e.length,n.length)}return null},generateUUID:function(){var t=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var r=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"===e?r:3&r|8).toString(16)})}},c=function(){this.constructor=c,this.initialize()},u=c.prototype;u.initialize=function(){this.networkRequests=0,this.url={host:e,tags:r},this.useLocalStorage=!!t.localStorage,this.state={urlCache:{},loadingTags:{},loadedTags:{}}},u.initGlimrId=function(){this.glimrId=o.readCookie("__glmrid"),this.glimrId||(this.glimrId=o.generateUUID(),this.setGlimrCookie())},u.setTagCacheTimeInSeconds=function(t){t>a&&(t=a),i.tags=t},u.getTagCacheTimeInSeconds=function(){return i.tags},u.setGlimrCookie=function(){o.createCookie("__glmrid",this.glimrId)},u.currentURLCacheKey=function(){return this.state.currentURLCacheKey?this.state.currentURLCacheKey:n(document.location.pathname).substr(0,10)},u.getPixelLastUpdated=function(t){return this.useLocalStorage?localStorage["glimrArticleTags_"+t+"_lastUpdate"]||!1:!1},u.getCachedURLTags=function(t){var e=this._getOrUnmarshalCache(t),r=this.currentURLCacheKey();return e[r]||(e[r]=[]),e[r]},u.getCachedTags=function(e){return t.console&&t.console.warn&&t.console.warn("`Glimr.getCachedTags` has been deprecated in favor of `Glimr.getCachedURLTags` for getting pre-fetched tags synchronously. `Glimr.getCachedTags` and `Glimr.getCachedURLTags` only return a subset of the available tags, use `Glimr.getTags` for fetching all tags, which takes care of caching behind the scenes."),this.getCachedURLTags.apply(this,arguments)},u.getTags=function(t,e){return this.state.loadedTags[t]?void e(this.state.loadedTags[t]):"undefined"!=typeof this.state.loadingTags[t]?void this.state.loadingTags[t].push(e):(this.state.loadingTags[t]=[],this.state.loadingTags[t].push(e),void this._requestTags(t,e,o.bindFunction(this,function(e){var r=[];e&&e.tags&&(r=e.tags),e&&e.cache&&this._updateURLCache(t,e.cache),this.usesTagCache()&&this._updateTagCache(t,r);for(var a=this.getCachedURLTags(t),n=0;n<a.length;n+=1)-1===r.indexOf(a[n])&&r.push(a[n]);this.state.loadedTags[t]=r;var i=this.state.loadingTags[t];delete this.state.loadingTags[t];for(var s=0;s<i.length;s+=1)i[s](r);"string"==typeof e.id&&e.id!==this.glimrId&&(this.glimrId=e.id,this.setGlimrCookie())})))},u._getLocalTags=function(t,e){var r=this._deserializeTags(localStorage["glimrTags_"+t]),a=this.getCachedURLTags(t);"object"==typeof r&&r.constructor===Array?e(r.concat(a)):(r.page=a,e(r))},u._requestTags=function(t,e,r){this.initGlimrId();var a=this.getPixelLastUpdated(t),n="";a&&(n+="&keywords_last_updated="+a);var s=(this.url.host+this.url.tags).replace(":id",t)+"?id="+this.glimrId+n;if(this.usesTagCache()){var c=parseInt(localStorage["glimrTags_"+t+"_lastUpdate"],10),u=(new Date).getTime();if(!isNaN(c)&&(u-c)/1e3<i.tags)return void this._getLocalTags(t,e)}o.JSONP(s,r)},u.getTagsAndPushToDataLayer=function(e,r){this.getTags(e,function(e){t.dataLayer&&t.dataLayer.push&&t.dataLayer.push({glimrTags:e,event:"glimr.tags"}),r&&"function"==typeof r&&r()})},u.usesTagCache=function(){return i.tags>0&&this.useLocalStorage},u.objectToQuery=function(t){var e=[];for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){var a=t[r];"object"==typeof a&&a.constructor===Array?e.push(this.arrayToQuery(a,r)):"object"==typeof r?e.push(this.objectToQuery(a)):e.push(this.escapeStringForQuery(r)+"="+this.escapeStringForQuery(a)),e.push("&")}return e.pop(),e.join("")},u.arrayToQuery=function(t,e){e=e||"";for(var r=this.escapeStringForQuery(e),a=[],n=0,i=t.length;i>n;n+=1){var s=this.escapeStringForQuery(t[n]);a.push(r+"="+s)}return a.join("&")},u.queryToObject=function(t){for(var e={},r=t.split("&"),a=0,n=r.length;n>a;a+=1){var i=r[a].split("="),s=this.unescapeStringForQuery(i[0]||""),o=this.unescapeStringForQuery(i[1]||"");"undefined"==typeof e[s]&&(e[s]=[]),o.length>0&&e[s].push(o)}return e},u.escapeStringForQuery=function(t){return encodeURIComponent(t)},u.unescapeStringForQuery=function(t){return decodeURIComponent(t)},u._unmarshalTags=function(t){if(!t)return{};for(var e=t.split("|"),r={},a=0;a<e.length;a+=1){var n=e[a].indexOf("="),i=e[a].substring(0,n);r[i]=this._deserializeTags(e[a].substring(n+1))}return r},u._marshalTags=function(t){var e=[];for(var r in t)t.hasOwnProperty(r)&&e.push(r.substr(0,10)+"="+this._serializeTags(t[r]));return e.join("|")},u._updateURLCache=function(t,e){this.useLocalStorage&&(localStorage["glimrArticleTags_"+t]=this._marshalTags(e),localStorage["glimrArticleTags_"+t+"_lastUpdate"]=(new Date).getTime()),this.state.urlCache[t]||(this.state.urlCache[t]={});for(var r in e)e.hasOwnProperty(r)&&(this.state.urlCache[t][r.substr(0,10)]=e[r])},u._getOrUnmarshalCache=function(t){return this.useLocalStorage&&localStorage["glimrArticleTags_"+t]&&(this.state.urlCache[t]=this._unmarshalTags(localStorage["glimrArticleTags_"+t])),this.state.urlCache[t]||{}},u._serializeTags=function(t){return"object"==typeof t&&t.constructor===Array?t.join(","):s+this.objectToQuery(t)},u._deserializeTags=function(t){return t=t||"",t.substr(0,s.length)===s?this.queryToObject(t.substr(s.length)):t.split(",")},u._updateTagCache=function(t,e){this.useLocalStorage&&(localStorage["glimrTags_"+t+"_lastUpdate"]=(new Date).getTime(),localStorage["glimrTags_"+t]=this._serializeTags(e))},n=function(t){function e(t,e){return t<<e|t>>>32-e}function r(t,e){var r,a,n,i,s;return n=2147483648&t,i=2147483648&e,r=1073741824&t,a=1073741824&e,s=(1073741823&t)+(1073741823&e),r&a?2147483648^s^n^i:r|a?1073741824&s?3221225472^s^n^i:1073741824^s^n^i:s^n^i}function a(t,e,r){return t&e|~t&r}function n(t,e,r){return t&r|e&~r}function i(t,e,r){return t^e^r}function s(t,e,r){return e^(t|~r)}function o(t,n,i,s,o,c,u){return t=r(t,r(r(a(n,i,s),o),u)),r(e(t,c),n)}function c(t,a,i,s,o,c,u){return t=r(t,r(r(n(a,i,s),o),u)),r(e(t,c),a)}function u(t,a,n,s,o,c,u){return t=r(t,r(r(i(a,n,s),o),u)),r(e(t,c),a)}function g(t,a,n,i,o,c,u){return t=r(t,r(r(s(a,n,i),o),u)),r(e(t,c),a)}function h(t){for(var e,r=t.length,a=r+8,n=(a-a%64)/64,i=16*(n+1),s=Array(i-1),o=0,c=0;r>c;)e=(c-c%4)/4,o=c%4*8,s[e]=s[e]|t.charCodeAt(c)<<o,c+=1;return e=(c-c%4)/4,o=c%4*8,s[e]=s[e]|128<<o,s[i-2]=r<<3,s[i-1]=r>>>29,s}function l(t){var e,r,a="",n="";for(r=0;3>=r;r+=1)e=t>>>8*r&255,n="0"+e.toString(16),a+=n.substr(n.length-2,2);return a}function d(t){t=t.replace(/\r\n/g,"\n");for(var e="",r=0;r<t.length;r+=1){var a=t.charCodeAt(r);128>a?e+=String.fromCharCode(a):a>127&&2048>a?(e+=String.fromCharCode(a>>6|192),e+=String.fromCharCode(63&a|128)):(e+=String.fromCharCode(a>>12|224),e+=String.fromCharCode(a>>6&63|128),e+=String.fromCharCode(63&a|128))}return e}var f,p,m,T,y,C,v,x,_,S=[],L=7,b=12,U=17,w=22,j=5,A=9,I=14,R=20,k=4,O=11,G=16,Q=23,F=6,D=10,z=15,P=21;for(t=d(t),S=h(t),C=1732584193,v=4023233417,x=2562383102,_=271733878,f=0;f<S.length;f+=16)p=C,m=v,T=x,y=_,C=o(C,v,x,_,S[f+0],L,3614090360),_=o(_,C,v,x,S[f+1],b,3905402710),x=o(x,_,C,v,S[f+2],U,606105819),v=o(v,x,_,C,S[f+3],w,3250441966),C=o(C,v,x,_,S[f+4],L,4118548399),_=o(_,C,v,x,S[f+5],b,1200080426),x=o(x,_,C,v,S[f+6],U,2821735955),v=o(v,x,_,C,S[f+7],w,4249261313),C=o(C,v,x,_,S[f+8],L,1770035416),_=o(_,C,v,x,S[f+9],b,2336552879),x=o(x,_,C,v,S[f+10],U,4294925233),v=o(v,x,_,C,S[f+11],w,2304563134),C=o(C,v,x,_,S[f+12],L,1804603682),_=o(_,C,v,x,S[f+13],b,4254626195),x=o(x,_,C,v,S[f+14],U,2792965006),v=o(v,x,_,C,S[f+15],w,1236535329),C=c(C,v,x,_,S[f+1],j,4129170786),_=c(_,C,v,x,S[f+6],A,3225465664),x=c(x,_,C,v,S[f+11],I,643717713),v=c(v,x,_,C,S[f+0],R,3921069994),C=c(C,v,x,_,S[f+5],j,3593408605),_=c(_,C,v,x,S[f+10],A,38016083),x=c(x,_,C,v,S[f+15],I,3634488961),v=c(v,x,_,C,S[f+4],R,3889429448),C=c(C,v,x,_,S[f+9],j,568446438),_=c(_,C,v,x,S[f+14],A,3275163606),x=c(x,_,C,v,S[f+3],I,4107603335),v=c(v,x,_,C,S[f+8],R,1163531501),C=c(C,v,x,_,S[f+13],j,2850285829),_=c(_,C,v,x,S[f+2],A,4243563512),x=c(x,_,C,v,S[f+7],I,1735328473),v=c(v,x,_,C,S[f+12],R,2368359562),C=u(C,v,x,_,S[f+5],k,4294588738),_=u(_,C,v,x,S[f+8],O,2272392833),x=u(x,_,C,v,S[f+11],G,1839030562),v=u(v,x,_,C,S[f+14],Q,4259657740),C=u(C,v,x,_,S[f+1],k,2763975236),_=u(_,C,v,x,S[f+4],O,1272893353),x=u(x,_,C,v,S[f+7],G,4139469664),v=u(v,x,_,C,S[f+10],Q,3200236656),C=u(C,v,x,_,S[f+13],k,681279174),_=u(_,C,v,x,S[f+0],O,3936430074),x=u(x,_,C,v,S[f+3],G,3572445317),v=u(v,x,_,C,S[f+6],Q,76029189),C=u(C,v,x,_,S[f+9],k,3654602809),_=u(_,C,v,x,S[f+12],O,3873151461),x=u(x,_,C,v,S[f+15],G,530742520),v=u(v,x,_,C,S[f+2],Q,3299628645),C=g(C,v,x,_,S[f+0],F,4096336452),_=g(_,C,v,x,S[f+7],D,1126891415),x=g(x,_,C,v,S[f+14],z,2878612391),v=g(v,x,_,C,S[f+5],P,4237533241),C=g(C,v,x,_,S[f+12],F,1700485571),_=g(_,C,v,x,S[f+3],D,2399980690),x=g(x,_,C,v,S[f+10],z,4293915773),v=g(v,x,_,C,S[f+1],P,2240044497),C=g(C,v,x,_,S[f+8],F,1873313359),_=g(_,C,v,x,S[f+15],D,4264355552),x=g(x,_,C,v,S[f+6],z,2734768916),v=g(v,x,_,C,S[f+13],P,1309151649),C=g(C,v,x,_,S[f+4],F,4149444226),_=g(_,C,v,x,S[f+11],D,3174756917),x=g(x,_,C,v,S[f+2],z,718787259),v=g(v,x,_,C,S[f+9],P,3951481745),C=r(C,p),v=r(v,m),x=r(x,T),_=r(_,y);var q=l(C)+l(v)+l(x)+l(_);return q.toLowerCase()},t.Glimr=new c}(window);
