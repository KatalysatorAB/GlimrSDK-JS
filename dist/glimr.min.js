!function(t,e){"use strict";var r=e(),n="function"==typeof define&&define.amd,a="undefined"!=typeof module&&module.exports;n?define(r):a?module.exports=r:window.Glimr=r}("glimr-sdk",function(){"use strict";var t="//pixel.glimr.io",e="/v4/iptags/:id/",r=300,n=function(){},a={tags:0},i="[v2]:",o=function(){var t,e,r=(new Date).getTime().toString();try{return(t=window.localStorage).setItem(r,r),e=t.getItem(r)===r,t.removeItem(r),e&&t}catch(n){}}(),s={flattenObjectIntoArray:function(t){var e=[];for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){var n=t[r];if("object"==typeof n&&n.constructor===Array)for(var a=0,i=n.length;i>a;a+=1)e.push(n[a]);else"object"==typeof n?e=e.concat(s.Library.flattenObjectIntoArray(n)):e.push(n)}return e},bindFunction:function(t,e){var r=Array.prototype.slice.call(arguments,2),n=e,a=function(){},i=function(){return n.apply(this instanceof a?this:t,r.concat(Array.prototype.slice.call(arguments)))};return e.prototype&&(a.prototype=e.prototype),i.prototype=new a,i},JSONP:function(t,e){var r=(new Date).getTime(),n="glmrjsonp"+Math.round(r+1000001*Math.random()),a=window.document.createElement("script");window[n]=function(t){e(t);try{delete window[n]}catch(r){window[n]=void 0}try{a.parentNode.removeChild(a)}catch(r){}},t+=-1===t.indexOf("?")?"?":"&",t+="callback="+n,"function"==typeof a.addEventListener&&a.addEventListener("error",function(){e(!1)},!1),a.setAttribute("src",t),window.document.getElementsByTagName("head")[0].appendChild(a)},createCookie:function(t,e,r){var n=window.document.location.hostname.split("."),a=n.slice(n.length-2,n.length).join("."),i="";if(r){var o=new Date;o.setTime(o.getTime()+24*r*60*60*1e3),i="; expires="+o.toGMTString()}window.document.cookie=t+"="+e+i+"; path=/; domain="+a},readCookie:function(t){for(var e=t+"=",r=window.document.cookie.split(";"),n=0;n<r.length;n+=1){for(var a=r[n];" "===a.charAt(0);)a=a.substring(1,a.length);if(0===a.indexOf(e))return a.substring(e.length,a.length)}return null},generateUUID:function(){var t=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var r=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"===e?r:3&r|8).toString(16)})}},u=function(){this.constructor=u,this.initialize()},c=u.prototype;return c.initialize=function(){this.networkRequests=0,this.url={host:t,tags:e},this.useLocalStorage=!!o,this.state={urlCache:{},loadingTags:{},loadedTags:{}}},c.initGlimrId=function(){this.glimrId=s.readCookie("__glmrid"),this.glimrId||(this.glimrId=s.generateUUID(),this.setGlimrCookie())},c.setTagCacheTimeInSeconds=function(t){t>r&&(t=r),a.tags=t},c.getTagCacheTimeInSeconds=function(){return a.tags},c.setGlimrCookie=function(){s.createCookie("__glmrid",this.glimrId)},c.currentURLCacheKey=function(){return this.state.currentURLCacheKey?this.state.currentURLCacheKey:n(this.currentURLIdentifier()).substr(0,10)},c.currentURLIdentifier=function(){return window.document.location.hash&&-1!==window.document.location.hash.indexOf("#!")?window.document.location.hash.replace("#!",""):window.document.location.pathname},c.getPixelLastUpdated=function(t){return this.useLocalStorage?o["glimrArticleTags_"+t+"_lastUpdate"]||!1:!1},c.getCachedURLTags=function(t){var e=this._getOrUnmarshalCache(t),r=this.currentURLCacheKey();return e[r]||(e[r]=[]),e[r]},c.getCachedBehaviorTags=function(t){if(this.usesTagCache()&&this.isTagCacheValid(t)){var e=this._getLocalTags(t);return e[0]}return!1},c.getCachedBehaviorTagsAndUpdateInBackground=function(t,e){if(e=e||{},e.onUpdate="function"==typeof e.onUpdate?e.onUpdate:function(){},!this.usesTagCache())return window.console&&window.console.error("Caching not enabled. Enable with Glimr.setTagCacheTimeInSeconds(number)"),[];var r=this._getLocalTags(t);return this.isTagCacheValid(t)||this.getTags(t,e.onUpdate),r[0]||!1},c.getTags=function(t,e){var r=t+this.currentURLCacheKey();if(this.state.loadedTags[r]){var n=this.state.loadedTags[r];return void e(n[0],n[1])}return"undefined"!=typeof this.state.loadingTags[r]?void this.state.loadingTags[r].push(e):void this._requestTags(t,r,e,s.bindFunction(this,function(e){var n=[],a={},i=n;e&&e.tags&&(n=e.tags,i=n),e&&e.mapping&&(a=e.mapping,i=a),e&&e.cache&&this._updateURLCache(t,e.cache),this.usesTagCache()&&this._updateTagCache(t,i);for(var o=this.getCachedURLTags(t),s=0;s<o.length;s+=1)-1===n.indexOf(o[s])&&(n.push(o[s]),a.urlTags=a.urlTags||[],a.urlTags.push(o[s]));this.state.loadedTags[r]=[n,a];var u=this.state.loadingTags[r];delete this.state.loadingTags[r];for(var c=0;c<u.length;c+=1)u[c](n,a);"string"==typeof e.id&&e.id!==this.glimrId&&(this.glimrId=e.id,this.setGlimrCookie())}))},c._getLocalTags=function(t){var e=this._deserializeTags(o["glimrTags_"+t]),r=this.getCachedURLTags(t);if("object"==typeof e&&e.constructor===Array)return[e.concat(r),{urlTags:r}];e.urlTags=r;var n=s.flattenObjectIntoArray(e);return[n,e]},c._requestTags=function(t,e,r,n){this.initGlimrId();var a=this.getPixelLastUpdated(t),i="";a&&(i+="&keywords_last_updated="+a),window.document.location.hash&&(i+="&fragment="+encodeURIComponent(window.document.location.hash));var o=(this.url.host+this.url.tags).replace(":id",t)+"?id="+this.glimrId+i;if(this.usesTagCache()&&this.isTagCacheValid(t)){var u=this._getLocalTags(t);return void r(u[0],u[1])}this.state.loadingTags[e]=[],this.state.loadingTags[e].push(r),this.networkRequests+=1,s.JSONP(o,n)},c.getTagsAndPushToDataLayer=function(t,e){this.getTags(t,function(t){window.dataLayer&&window.dataLayer.push&&window.dataLayer.push({glimrTags:t,event:"glimr.tags"}),e&&"function"==typeof e&&e()})},c.usesTagCache=function(){return a.tags>0&&this.useLocalStorage},c.isTagCacheValid=function(t){var e=parseInt(o["glimrTags_"+t+"_lastUpdate"],10),r=(new Date).getTime();return!isNaN(e)&&(r-e)/1e3<a.tags},c.objectToQuery=function(t){var e=[];for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){var n=t[r];"object"==typeof n&&n.constructor===Array?e.push(this.arrayToQuery(n,r)):"object"==typeof r?e.push(this.objectToQuery(n)):e.push(this.escapeStringForQuery(r)+"="+this.escapeStringForQuery(n)),e.push("&")}return e.pop(),e.join("")},c.arrayToQuery=function(t,e){e=e||"";for(var r=this.escapeStringForQuery(e),n=[],a=0,i=t.length;i>a;a+=1){var o=this.escapeStringForQuery(t[a]);n.push(r+"="+o)}return n.join("&")},c.queryToObject=function(t){for(var e={},r=t.split("&"),n=0,a=r.length;a>n;n+=1){var i=r[n].split("="),o=this.unescapeStringForQuery(i[0]||""),s=this.unescapeStringForQuery(i[1]||"");"undefined"==typeof e[o]&&(e[o]=[]),s.length>0&&e[o].push(s)}return e},c.escapeStringForQuery=function(t){return encodeURIComponent(t)},c.unescapeStringForQuery=function(t){return decodeURIComponent(t)},c._unmarshalTags=function(t){if(!t)return{};for(var e=t.split("|"),r={},n=0;n<e.length;n+=1){var a=e[n].indexOf("="),i=e[n].substring(0,a);r[i]=this._deserializeTags(e[n].substring(a+1))}return r},c._marshalTags=function(t){var e=[];for(var r in t)t.hasOwnProperty(r)&&e.push(r.substr(0,10)+"="+this._serializeTags(t[r]));return e.join("|")},c._updateURLCache=function(t,e){this.useLocalStorage&&(o["glimrArticleTags_"+t]=this._marshalTags(e),o["glimrArticleTags_"+t+"_lastUpdate"]=(new Date).getTime()),this.state.urlCache[t]||(this.state.urlCache[t]={});for(var r in e)e.hasOwnProperty(r)&&(this.state.urlCache[t][r.substr(0,10)]=e[r])},c._getOrUnmarshalCache=function(t){return this.useLocalStorage&&o["glimrArticleTags_"+t]&&(this.state.urlCache[t]=this._unmarshalTags(o["glimrArticleTags_"+t])),this.state.urlCache[t]||{}},c._serializeTags=function(t){return"object"==typeof t&&t.constructor===Array?t.join(","):i+this.objectToQuery(t)},c._deserializeTags=function(t){return t=t||"",t.substr(0,i.length)===i?this.queryToObject(t.substr(i.length)):""===t?[]:t.split(",")},c._updateTagCache=function(t,e){this.useLocalStorage&&(o["glimrTags_"+t+"_lastUpdate"]=(new Date).getTime(),o["glimrTags_"+t]=this._serializeTags(e))},n=function(t){function e(t,e){return t<<e|t>>>32-e}function r(t,e){var r,n,a,i,o;return a=2147483648&t,i=2147483648&e,r=1073741824&t,n=1073741824&e,o=(1073741823&t)+(1073741823&e),r&n?2147483648^o^a^i:r|n?1073741824&o?3221225472^o^a^i:1073741824^o^a^i:o^a^i}function n(t,e,r){return t&e|~t&r}function a(t,e,r){return t&r|e&~r}function i(t,e,r){return t^e^r}function o(t,e,r){return e^(t|~r)}function s(t,a,i,o,s,u,c){return t=r(t,r(r(n(a,i,o),s),c)),r(e(t,u),a)}function u(t,n,i,o,s,u,c){return t=r(t,r(r(a(n,i,o),s),c)),r(e(t,u),n)}function c(t,n,a,o,s,u,c){return t=r(t,r(r(i(n,a,o),s),c)),r(e(t,u),n)}function h(t,n,a,i,s,u,c){return t=r(t,r(r(o(n,a,i),s),c)),r(e(t,u),n)}function g(t){for(var e,r=t.length,n=r+8,a=(n-n%64)/64,i=16*(a+1),o=Array(i-1),s=0,u=0;r>u;)e=(u-u%4)/4,s=u%4*8,o[e]=o[e]|t.charCodeAt(u)<<s,u+=1;return e=(u-u%4)/4,s=u%4*8,o[e]=o[e]|128<<s,o[i-2]=r<<3,o[i-1]=r>>>29,o}function l(t){var e,r,n="",a="";for(r=0;3>=r;r+=1)e=t>>>8*r&255,a="0"+e.toString(16),n+=a.substr(a.length-2,2);return n}function d(t){t=t.replace(/\r\n/g,"\n");for(var e="",r=0;r<t.length;r+=1){var n=t.charCodeAt(r);128>n?e+=String.fromCharCode(n):n>127&&2048>n?(e+=String.fromCharCode(n>>6|192),e+=String.fromCharCode(63&n|128)):(e+=String.fromCharCode(n>>12|224),e+=String.fromCharCode(n>>6&63|128),e+=String.fromCharCode(63&n|128))}return e}var f,p,m,T,y,v,C,w,x,_=[],b=7,L=12,U=17,S=22,I=5,j=9,A=14,O=20,R=4,k=11,Q=16,D=23,F=6,P=10,z=15,G=21;for(t=d(t),_=g(t),v=1732584193,C=4023233417,w=2562383102,x=271733878,f=0;f<_.length;f+=16)p=v,m=C,T=w,y=x,v=s(v,C,w,x,_[f+0],b,3614090360),x=s(x,v,C,w,_[f+1],L,3905402710),w=s(w,x,v,C,_[f+2],U,606105819),C=s(C,w,x,v,_[f+3],S,3250441966),v=s(v,C,w,x,_[f+4],b,4118548399),x=s(x,v,C,w,_[f+5],L,1200080426),w=s(w,x,v,C,_[f+6],U,2821735955),C=s(C,w,x,v,_[f+7],S,4249261313),v=s(v,C,w,x,_[f+8],b,1770035416),x=s(x,v,C,w,_[f+9],L,2336552879),w=s(w,x,v,C,_[f+10],U,4294925233),C=s(C,w,x,v,_[f+11],S,2304563134),v=s(v,C,w,x,_[f+12],b,1804603682),x=s(x,v,C,w,_[f+13],L,4254626195),w=s(w,x,v,C,_[f+14],U,2792965006),C=s(C,w,x,v,_[f+15],S,1236535329),v=u(v,C,w,x,_[f+1],I,4129170786),x=u(x,v,C,w,_[f+6],j,3225465664),w=u(w,x,v,C,_[f+11],A,643717713),C=u(C,w,x,v,_[f+0],O,3921069994),v=u(v,C,w,x,_[f+5],I,3593408605),x=u(x,v,C,w,_[f+10],j,38016083),w=u(w,x,v,C,_[f+15],A,3634488961),C=u(C,w,x,v,_[f+4],O,3889429448),v=u(v,C,w,x,_[f+9],I,568446438),x=u(x,v,C,w,_[f+14],j,3275163606),w=u(w,x,v,C,_[f+3],A,4107603335),C=u(C,w,x,v,_[f+8],O,1163531501),v=u(v,C,w,x,_[f+13],I,2850285829),x=u(x,v,C,w,_[f+2],j,4243563512),w=u(w,x,v,C,_[f+7],A,1735328473),C=u(C,w,x,v,_[f+12],O,2368359562),v=c(v,C,w,x,_[f+5],R,4294588738),x=c(x,v,C,w,_[f+8],k,2272392833),w=c(w,x,v,C,_[f+11],Q,1839030562),C=c(C,w,x,v,_[f+14],D,4259657740),v=c(v,C,w,x,_[f+1],R,2763975236),x=c(x,v,C,w,_[f+4],k,1272893353),w=c(w,x,v,C,_[f+7],Q,4139469664),C=c(C,w,x,v,_[f+10],D,3200236656),v=c(v,C,w,x,_[f+13],R,681279174),x=c(x,v,C,w,_[f+0],k,3936430074),w=c(w,x,v,C,_[f+3],Q,3572445317),C=c(C,w,x,v,_[f+6],D,76029189),v=c(v,C,w,x,_[f+9],R,3654602809),x=c(x,v,C,w,_[f+12],k,3873151461),w=c(w,x,v,C,_[f+15],Q,530742520),C=c(C,w,x,v,_[f+2],D,3299628645),v=h(v,C,w,x,_[f+0],F,4096336452),x=h(x,v,C,w,_[f+7],P,1126891415),w=h(w,x,v,C,_[f+14],z,2878612391),C=h(C,w,x,v,_[f+5],G,4237533241),v=h(v,C,w,x,_[f+12],F,1700485571),x=h(x,v,C,w,_[f+3],P,2399980690),w=h(w,x,v,C,_[f+10],z,4293915773),C=h(C,w,x,v,_[f+1],G,2240044497),v=h(v,C,w,x,_[f+8],F,1873313359),x=h(x,v,C,w,_[f+15],P,4264355552),w=h(w,x,v,C,_[f+6],z,2734768916),C=h(C,w,x,v,_[f+13],G,1309151649),v=h(v,C,w,x,_[f+4],F,4149444226),x=h(x,v,C,w,_[f+11],P,3174756917),w=h(w,x,v,C,_[f+2],z,718787259),C=h(C,w,x,v,_[f+9],G,3951481745),v=r(v,p),C=r(C,m),w=r(w,T),x=r(x,y);var q=l(v)+l(C)+l(w)+l(x);return q.toLowerCase()},new u});
